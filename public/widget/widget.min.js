!function(){"use strict";const n=function(){const n=document.getElementsByTagName("script");for(let e=0;e<n.length;e++){const t=n[e].src;if(t&&(t.includes("widget.min.js")||t.includes("widget.js")))try{return new URL(t).origin}catch(n){console.warn("CSAI: Failed to parse script URL")}}return window.location.origin}();let e={...{widgetId:"default",apiUrl:n+"/api/chat",configUrl:n+"/api/widget/",position:"bottom-right",primaryColor:"#6366f1",textColor:"#ffffff",greeting:"Halo! ðŸ‘‹ Ada yang bisa saya bantu hari ini?",placeholder:"Ketik pesan...",title:"Customer Service",subtitle:"Biasanya membalas dalam beberapa detik",offlineMessage:"Maaf, layanan sedang tidak tersedia. Silakan coba lagi nanti.",storageKey:"csai_chat_history",maxHistoryLength:50,avatarType:"icon",avatarIcon:"robot",avatarUrl:"",showBranding:!0},...window.CSAIConfig||{}},t=!1,a=!1,i=[],s=null;function o(){return"sess_"+Math.random().toString(36).substr(2,9)+Date.now().toString(36)}function r(n,e){const t=n.replace("#",""),a=parseInt(t,16);return"#"+(16777216+65536*Math.min(255,Math.max(0,(a>>16)+e))+256*Math.min(255,Math.max(0,(a>>8&255)+e))+Math.min(255,Math.max(0,(255&a)+e))).toString(16).slice(1)}function c(){const n=document.createElement("div");n.className="csai-widget",n.id="csai-widget",n.innerHTML=`\n      \x3c!-- Floating Button --\x3e\n      <button class="csai-button" id="csai-toggle">\n        <svg class="chat-icon" viewBox="0 0 24 24">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>\n          <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>\n        </svg>\n        <svg class="close-icon" viewBox="0 0 24 24">\n          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n        </svg>\n        <span class="csai-badge" id="csai-badge">0</span>\n      </button>\n\n      \x3c!-- Chat Window --\x3e\n      <div class="csai-window" id="csai-window">\n        \x3c!-- Header --\x3e\n        <div class="csai-header">\n          <div class="csai-header-avatar">${function(){if("url"===e.avatarType&&e.avatarUrl)return`<img src="${e.avatarUrl}" alt="Avatar" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;const n={robot:'<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">\n        <path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 011 1v3a1 1 0 01-1 1h-1v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-1H2a1 1 0 01-1-1v-3a1 1 0 011-1h1a7 7 0 017-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 012-2M7.5 13A1.5 1.5 0 006 14.5 1.5 1.5 0 007.5 16 1.5 1.5 0 009 14.5 1.5 1.5 0 007.5 13m9 0a1.5 1.5 0 00-1.5 1.5 1.5 1.5 0 001.5 1.5 1.5 1.5 0 001.5-1.5 1.5 1.5 0 00-1.5-1.5M12 9a5 5 0 00-5 5v1h10v-1a5 5 0 00-5-5z"/>\n      </svg>',support:'<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">\n        <path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"/>\n      </svg>',user:'<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>\n      </svg>'};return n[e.avatarIcon]||n.robot}()}</div>\n          <div class="csai-header-info">\n            <p class="csai-header-title">${e.title}</p>\n            <p class="csai-header-subtitle">${e.subtitle}</p>\n          </div>\n          <button class="csai-header-close" id="csai-close">\n            <svg viewBox="0 0 24 24">\n              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n            </svg>\n          </button>\n        </div>\n\n        \x3c!-- Messages --\x3e\n        <div class="csai-messages" id="csai-messages"></div>\n\n        \x3c!-- Input Area --\x3e\n        <div class="csai-input-area">\n          <textarea \n            class="csai-input" \n            id="csai-input" \n            placeholder="${e.placeholder}"\n            rows="1"\n          ></textarea>\n          <button class="csai-send" id="csai-send">\n            <svg viewBox="0 0 24 24">\n              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n            </svg>\n          </button>\n        </div>\n\n        \x3c!-- Powered By --\x3e\n        ${e.showBranding?'<div class="csai-powered">\n          Powered by <a href="https://cekat.biz.id" target="_blank">cekat.biz.id</a>\n        </div>':""}\n      </div>\n    `,document.body.appendChild(n)}function l(n,t,a=!1){const o=document.getElementById("csai-messages"),r=document.createElement("div");r.className=`csai-message ${n}`,"assistant"===n?r.innerHTML=function(n){if(!n)return"";let e=[];return n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/```([\s\S]*?)```/g,function(n){return e.push(n),`__CODE_BLOCK_${e.length-1}__`})).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/`([^`]+)`/g,"<code>$1</code>")).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/\*([^*]+)\*/g,"<em>$1</em>")).replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" class="csai-link">$1</a>')).replace(/^\s*-\s+(.*)$/gm,'<li class="ul-item">$1</li>')).replace(/((?:<li class="ul-item">.*<\/li>\n?)+)/g,'<ul class="csai-ul">$1</ul>')).replace(/^\s*\d+\.\s+(.*)$/gm,'<li class="ol-item">$1</li>')).replace(/((?:<li class="ol-item">.*<\/li>\n?)+)/g,'<ol class="csai-ol">$1</ol>')).replace(/\n/g,"<br>")).replace(/(<\/ul>|<\/ol>|<\/pre>|<pre>)<br>/g,"$1")).replace(/__CODE_BLOCK_(\d+)__/g,function(n,t){let a=e[t];return a=a.substring(3,a.length-3),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),`<pre><code>${a}</code></pre>`})}(t):r.textContent=t,o.appendChild(r),o.scrollTop=o.scrollHeight,a||(i.push({role:n,content:t}),function(){try{localStorage.setItem(e.storageKey+"_"+e.widgetId,JSON.stringify({history:i.slice(-e.maxHistoryLength),sessionId:s}))}catch(n){console.warn("CSAI: Failed to save chat history")}}())}function d(){const n=document.getElementById("csai-typing");n&&n.remove()}async function p(n){if(a||!n.trim())return;a=!0;const t=document.getElementById("csai-send");t.disabled=!0,l("user",n),function(){const n=document.getElementById("csai-messages"),e=document.createElement("div");e.className="csai-typing",e.id="csai-typing",e.innerHTML="<span></span><span></span><span></span>",n.appendChild(e),n.scrollTop=n.scrollHeight}();try{const t=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,widgetId:e.widgetId,history:i.map(n=>({role:n.role,content:n.content})),sessionId:s})}),a=await t.json();d(),a.success&&a.response?(l("assistant",a.response),a.sessionId&&(s=a.sessionId)):"quota_exceeded"===a.error?l("assistant","âš ï¸ **Kuota Pesan Habis**\n\nMaaf, chatbot ini sudah mencapai batas pesan bulanan.\n\nSilakan hubungi pemilik website untuk informasi lebih lanjut."):l("assistant",a.message||a.error||e.offlineMessage)}catch(n){console.error("CSAI Error:",n),d(),l("assistant",e.offlineMessage)}finally{a=!1,t.disabled=!1}}function g(){t=!t;const n=document.getElementById("csai-window"),a=document.getElementById("csai-toggle");t?(n.classList.add("open"),a.classList.add("open"),document.getElementById("csai-input").focus(),0===i.length&&setTimeout(()=>{l("assistant",e.greeting);const n=document.getElementById("csai-messages");n&&(n.scrollTop=n.scrollHeight)},500),setTimeout(()=>{const n=document.getElementById("csai-messages");n&&(n.scrollTop=n.scrollHeight)},100)):(n.classList.remove("open"),a.classList.remove("open"))}async function u(){if(document.getElementById("csai-widget"))return;const a=window.CSAIConfig||{};if(a.widgetId&&!a.title&&"default"!==a.widgetId&&await async function(t){try{const a=await fetch(n+"/api/widget/"+t+"/config");if(a.ok){const t=await a.json();return e={...e,...t},e.apiUrl=n+"/api/chat",!0}}catch(n){console.warn("CSAI: Failed to fetch widget config")}return!1}(a.widgetId),!function(){const n=e.allowedDomain||"";if(!n||""===n.trim())return!0;const t=window.location.hostname.toLowerCase(),a=n.toLowerCase().trim();if("localhost"===t||"127.0.0.1"===t)return!0;if(t===a)return!0;if(t.endsWith("."+a))return!0;if(a.startsWith("www.")){const n=a.substring(4);if(t===n||t.endsWith("."+n))return!0}else if(t==="www."+a)return!0;return!1}())return console.error("CSAI Widget Error: This widget is not authorized for this domain."),console.error("Current domain: "+window.location.hostname),console.error("Allowed domain: "+(e.allowedDomain||"Not configured")),void console.error("Please configure the allowed domain in your Cekat dashboard.");!function(){try{const n=localStorage.getItem(e.storageKey+"_"+e.widgetId);if(n){const e=JSON.parse(n);i=e.history||[],s=e.sessionId||o()}else s=o()}catch(n){s=o()}}(),function(){const n=`\n      .csai-widget * {\n        box-sizing: border-box;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      }\n\n      .csai-widget {\n        position: fixed;\n        ${e.position.includes("right")?"right: 20px;":"left: 20px;"}\n        ${e.position.includes("bottom")?"bottom: 20px;":"top: 20px;"}\n        z-index: 999999;\n        font-size: 14px;\n      }\n\n      /* Floating Button */\n      .csai-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, ${e.primaryColor}, ${r(e.primaryColor,-20)});\n        border: none;\n        cursor: pointer;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.3s ease;\n        position: relative;\n      }\n\n      .csai-button:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);\n      }\n\n      .csai-button svg {\n        width: 28px;\n        height: 28px;\n        fill: ${e.textColor};\n        transition: all 0.3s ease;\n      }\n\n      .csai-button.open svg.chat-icon {\n        display: none;\n      }\n\n      .csai-button.open svg.close-icon {\n        display: block;\n      }\n\n      .csai-button svg.close-icon {\n        display: none;\n      }\n\n      /* Notification Badge */\n      .csai-badge {\n        position: absolute;\n        top: -5px;\n        right: -5px;\n        background: #ef4444;\n        color: white;\n        font-size: 12px;\n        font-weight: bold;\n        width: 22px;\n        height: 22px;\n        border-radius: 50%;\n        display: none;\n        align-items: center;\n        justify-content: center;\n        border: 2px solid white;\n      }\n\n      /* Chat Window */\n      .csai-window {\n        position: absolute;\n        ${e.position.includes("right")?"right: 0;":"left: 0;"}\n        bottom: 75px;\n        width: 380px;\n        height: 550px;\n        max-height: calc(100vh - 120px);\n        background: #ffffff;\n        border-radius: 16px;\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n        display: none;\n        flex-direction: column;\n        overflow: hidden;\n        animation: csai-slide-up 0.3s ease;\n      }\n\n      .csai-window.open {\n        display: flex;\n      }\n\n      @keyframes csai-slide-up {\n        from {\n          opacity: 0;\n          transform: translateY(20px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n\n      /* Header */\n      .csai-header {\n        background: linear-gradient(135deg, ${e.primaryColor}, ${r(e.primaryColor,-20)});\n        color: ${e.textColor};\n        padding: 20px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\n      .csai-header-avatar {\n        width: 45px;\n        height: 45px;\n        background: rgba(255, 255, 255, 0.2);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n\n      .csai-header-info {\n        flex: 1;\n      }\n\n      .csai-header-title {\n        font-size: 16px;\n        font-weight: 600;\n        margin: 0 0 4px 0;\n      }\n\n      .csai-header-subtitle {\n        font-size: 12px;\n        opacity: 0.9;\n        margin: 0;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n\n      .csai-header-subtitle::before {\n        content: '';\n        width: 8px;\n        height: 8px;\n        background: #22c55e;\n        border-radius: 50%;\n        display: inline-block;\n      }\n\n      .csai-header-close {\n        background: rgba(255, 255, 255, 0.2);\n        border: none;\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background 0.2s;\n      }\n\n      .csai-header-close:hover {\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      .csai-header-close svg {\n        width: 18px;\n        height: 18px;\n        fill: ${e.textColor};\n      }\n\n      /* Messages Container */\n      .csai-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        background: #f8fafc;\n      }\n\n      .csai-messages::-webkit-scrollbar {\n        width: 6px;\n      }\n\n      .csai-messages::-webkit-scrollbar-track {\n        background: transparent;\n      }\n\n      .csai-messages::-webkit-scrollbar-thumb {\n        background: #cbd5e1;\n        border-radius: 3px;\n      }\n\n      /* Message Bubbles */\n      .csai-message {\n        max-width: 85%;\n        padding: 12px 16px;\n        border-radius: 16px;\n        line-height: 1.5;\n        animation: csai-fade-in 0.3s ease;\n      }\n\n      @keyframes csai-fade-in {\n        from {\n          opacity: 0;\n          transform: translateY(10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n\n      .csai-message.user {\n        background: ${e.primaryColor};\n        color: ${e.textColor};\n        margin-left: auto;\n        border-bottom-right-radius: 4px;\n      }\n\n      .csai-message.assistant {\n        background: #ffffff;\n        color: #1e293b;\n        margin-right: auto;\n        border-bottom-left-radius: 4px;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n      }\n\n      /* Typing Indicator */\n      .csai-typing {\n        display: flex;\n        gap: 4px;\n        padding: 16px;\n        background: #ffffff;\n        border-radius: 16px;\n        border-bottom-left-radius: 4px;\n        width: fit-content;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n      }\n\n      .csai-typing span {\n        width: 8px;\n        height: 8px;\n        background: #94a3b8;\n        border-radius: 50%;\n        animation: csai-bounce 1.4s infinite ease-in-out;\n      }\n\n      .csai-typing span:nth-child(1) { animation-delay: -0.32s; }\n      .csai-typing span:nth-child(2) { animation-delay: -0.16s; }\n      .csai-typing span:nth-child(3) { animation-delay: 0s; }\n\n      @keyframes csai-bounce {\n        0%, 80%, 100% { transform: scale(0.6); }\n        40% { transform: scale(1); }\n      }\n\n      /* Input Area */\n      .csai-input-area {\n        padding: 16px;\n        background: #ffffff;\n        border-top: 1px solid #e2e8f0;\n        display: flex;\n        gap: 12px;\n        align-items: center;\n      }\n\n      .csai-input {\n        flex: 1;\n        border: 1px solid #e2e8f0;\n        border-radius: 24px;\n        padding: 12px 20px;\n        font-size: 14px;\n        outline: none;\n        transition: border-color 0.2s, box-shadow 0.2s;\n        resize: none;\n        max-height: 100px;\n        min-height: 44px;\n      }\n\n      .csai-input:focus {\n        border-color: ${e.primaryColor};\n        box-shadow: 0 0 0 3px ${e.primaryColor}20;\n      }\n\n      .csai-input::placeholder {\n        color: #94a3b8;\n      }\n\n      .csai-send {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background: ${e.primaryColor};\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        flex-shrink: 0;\n      }\n\n      .csai-send:hover:not(:disabled) {\n        background: ${r(e.primaryColor,-15)};\n        transform: scale(1.05);\n      }\n\n      .csai-send:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .csai-send svg {\n        width: 20px;\n        height: 20px;\n        fill: ${e.textColor};\n      }\n\n      /* Powered By */\n      .csai-powered {\n        text-align: center;\n        padding: 8px;\n        font-size: 11px;\n        color: #94a3b8;\n        background: #ffffff;\n      }\n\n      .csai-powered a {\n        color: ${e.primaryColor};\n        text-decoration: none;\n      }\n\n      /* Markdown Styles */\n      .csai-ul, .csai-ol { margin: 8px 0; padding-left: 20px; }\n      .csai-ul li { list-style-type: disc; margin-bottom: 4px; }\n      .csai-ol li { list-style-type: decimal; margin-bottom: 4px; }\n      strong { font-weight: 600; }\n      em { font-style: italic; }\n      code { background: #f1f5f9; padding: 2px 4px; border-radius: 4px; font-family: monospace; font-size: 0.9em; color: #e11d48; }\n      pre { background: #1e293b; color: #fff; padding: 12px; border-radius: 8px; overflow-x: auto; margin: 8px 0; }\n      pre code { background: transparent; color: inherit; padding: 0; }\n      .csai-link { color: #2563eb; text-decoration: underline; }\n      \n      @media (max-width: 480px) {\n        .csai-window {\n          width: calc(100vw - 20px);\n          height: calc(100vh - 100px);\n          ${e.position.includes("right")?"right: 10px;":"left: 10px;"}\n          bottom: 80px;\n          border-radius: 12px;\n        }\n\n        .csai-button {\n          width: 55px;\n          height: 55px;\n        }\n      }\n    `,t=document.createElement("style");t.id="csai-styles",t.textContent=n+"\n      .csai-input::-webkit-scrollbar {\n        display: none;\n      }\n      .csai-input {\n        -ms-overflow-style: none;\n        scrollbar-width: none;\n      }\n    ",document.head.appendChild(t)}(),c(),function(){const n=document.getElementById("csai-toggle"),e=document.getElementById("csai-close"),t=document.getElementById("csai-send"),a=document.getElementById("csai-input");n.addEventListener("click",g),e.addEventListener("click",g),t.addEventListener("click",()=>{p(a.value),a.value="",a.style.height="auto"}),a.addEventListener("keydown",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),p(a.value),a.value="",a.style.height="auto")}),a.addEventListener("input",()=>{a.style.height="auto",a.style.height=Math.min(a.scrollHeight,100)+"px"})}(),document.getElementById("csai-messages").innerHTML="",i.forEach(n=>{l(n.role,n.content,!0)}),console.log("CSAI Widget initialized"),setTimeout(()=>{t||g()},3e3)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}();